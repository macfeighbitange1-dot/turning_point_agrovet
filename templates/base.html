<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="theme-color" content="#2d5a27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/logo.png') }}">
    
    <title>Turning Point Agrovet | Professional Farming Solutions</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="logo">TURNING POINT <span>AGROVET</span></div>
        
        <div class="nav-container">
            <form action="/search" method="GET" class="search-form">
                <input type="text" name="q" placeholder="Search seeds, tools..." 
                       class="search-input"
                       value="{{ query if query else '' }}">
                <button type="submit" class="search-btn">üîç</button>
            </form>

            <ul class="nav-links">
                <li><a href="{{ url_for('home') }}">Home</a></li>
                <li><a href="{{ url_for('consultancy') }}">Consultancy</a></li>
                
                {% if current_user.is_authenticated %}
                    {% if current_user.is_admin %}
                        <li><a href="{{ url_for('admin_dashboard') }}" class="admin-link">Dashboard</a></li>
                    {% endif %}
                    <li><a href="{{ url_for('logout') }}" class="logout-link">Logout</a></li>
                {% else %}
                    <li><a href="{{ url_for('login') }}">Login</a></li>
                {% endif %}
            </ul>
        </div>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-wrapper">
            {% for category, message in messages %}
              <div class="flash-message flash-{{ category }}">
                {{ message }}
              </div>
            {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <main>
        {% block content %}{% endblock %}
    </main>

    <footer class="main-footer">
        <p>&copy; 2026 Turning Point Agrovet. Cultivating Excellence in Kirinyaga.</p>
    </footer>

    <a href="{{ url_for('cart') }}" class="cart-float">
        <svg style="width:28px;height:28px" viewBox="0 0 24 24">
            <path fill="currentColor" d="M17,18C15.89,18 15,18.89 15,20A2,2 0 0,0 17,22A2,2 0 0,0 19,20C19,18.89 18.11,18 17,18M7,18C5.89,18 5,18.89 5,20A2,2 0 0,0 7,22A2,2 0 0,0 9,20C9,18.89 8.11,18 7,18M7.27,18L5.75,14.54L4.53,11.75L3,4H1V2H4.27L5.21,4H20A1,1 0 0,1 21,5C21,5.17 20.95,5.34 20.88,5.5L17.3,11.97C16.96,12.58 16.3,13 15.55,13H8.1L7.27,18Z" />
        </svg>
        <span class="cart-count" id="cart-count">0</span>
    </a>

    <a href="https://wa.me/254722415182?text=Hello%20Turning%20Point%20Agrovet,%20I%20am%20interested%20in%20your%20products." 
       class="whatsapp-float" 
       target="_blank">
        <svg style="width:35px;height:35px" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01A9.82 9.82 0 0 0 12.04 2m.01 1.67c2.2 0 4.26.86 5.82 2.42a8.23 8.23 0 0 1 2.41 5.83c0 4.54-3.7 8.23-8.24 8.23-1.48 0-2.93-.39-4.19-1.15l-.3-.17-3.12.82.83-3.04-.19-.3a8.23 8.23 0 0 1-1.26-4.38c0-4.54 3.7-8.24 8.24-8.24m-3.53 4.75c-.19 0-.52.07-.79.37-.27.3-1.03 1.01-1.03 2.47s1.06 2.87 1.21 3.07c.15.19 2.09 3.19 5.05 4.48.7.3 1.26.48 1.68.62.71.22 1.35.19 1.86.12.57-.08 1.74-.71 1.99-1.4s.25-1.27.17-1.4c-.07-.12-.27-.19-.57-.34s-1.75-.86-2.02-.96-.47-.15-.67.15-.77.96-.94 1.15c-.17.19-.34.21-.64.06-.3-.15-1.26-.47-2.39-1.48-.88-.79-1.48-1.76-1.65-2.05-.17-.3-.02-.46.13-.61l.45-.53c.15-.19.2-.32.3-.53s.05-.4-.02-.55-.67-1.6-.92-2.2c-.24-.59-.49-.51-.67-.51" />
        </svg>
    </a>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                .then(reg => console.log('Service Worker registered.'))
                .catch(err => console.log('Service Worker registration failed.', err));
            });
        }
    </script>

    <style>
        /* CSS Cleanups for the Refactored Elements */
        .nav-container { display: flex; align-items: center; gap: 30px; }
        .search-form { display: flex; background: #f1f1f1; border-radius: 25px; padding: 2px 15px; border: 1px solid #e0e0e0; }
        .search-input { border: none; background: transparent; padding: 0.6rem; outline: none; width: 200px; font-family: 'Inter', sans-serif; }
        .search-btn { background: transparent; border: none; cursor: pointer; padding: 0 5px; }
        .nav-links { display: flex; list-style: none; margin: 0; padding: 0; align-items: center; gap: 20px; }
        .admin-link { color: #ffcc00 !important; font-weight: 700; }
        .logout-link { color: #ff6b6b !important; }
        .flash-wrapper { position: fixed; top: 0; width: 100%; z-index: 2000; }
        .flash-message { padding: 1rem; text-align: center; font-weight: 500; animation: slideDown 0.5s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .flash-success { background: #d4edda; color: #155724; }
        .flash-info { background: #d1ecf1; color: #0c5460; }
        .flash-danger { background: #f8d7da; color: #721c24; }
        .main-footer { text-align: center; padding: 3rem; background: #1e3d1a; color: white; margin-top: 4rem; }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        /* Mobile specific base tweaks */
        @media (max-width: 768px) {
            .nav-container { flex-direction: column; gap: 10px; width: 100%; padding-bottom: 10px; }
            .search-input { width: 150px; }
            .nav-links { gap: 10px; font-size: 0.8rem; }
        }
    </style>
</body>
</html>